{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Athena Usage Analyser - Captures and analyzes Amazon Athena usage. Deployed with security best practices for customer environments.",
  "Metadata": {
    "AWS::CloudFormation::Interface": {
      "ParameterGroups": [
        {
          "Label": {
            "default": "Monitoring Configuration"
          },
          "Parameters": [
            "AthenaWorkgroups",
            "S3BucketsToMonitor",
            "CloudTrailBucket"
          ]
        },
        {
          "Label": {
            "default": "Multi-Account Configuration"
          },
          "Parameters": [
            "AnalysisMode",
            "MonitoredAccountIds",
            "CrossAccountExternalId"
          ]
        },
        {
          "Label": {
            "default": "AWS Organizations Configuration (Optional)"
          },
          "Parameters": [
            "MultiAccountMethod",
            "OrganizationId",
            "OrgTrailBucket"
          ]
        },
        {
          "Label": {
            "default": "Schedule Configuration"
          },
          "Parameters": [
            "AnalysisIntervalMinutes",
            "RetentionDays"
          ]
        },
        {
          "Label": {
            "default": "Security Configuration"
          },
          "Parameters": [
            "KMSKeyArn"
          ]
        },
        {
          "Label": {
            "default": "Lambda Code (set automatically by deploy script)"
          },
          "Parameters": [
            "LambdaCodeBucket",
            "LambdaCodeKey"
          ]
        }
      ],
      "ParameterLabels": {
        "AthenaWorkgroups": {
          "default": "Athena Workgroups to Monitor"
        },
        "S3BucketsToMonitor": {
          "default": "S3 Buckets to Monitor"
        },
        "CloudTrailBucket": {
          "default": "CloudTrail Logs Bucket (Optional)"
        },
        "AnalysisIntervalMinutes": {
          "default": "Analysis Interval (Minutes)"
        },
        "RetentionDays": {
          "default": "Data Retention (Days)"
        },
        "KMSKeyArn": {
          "default": "KMS Key ARN (Optional)"
        },
        "AnalysisMode": {
          "default": "Analysis Mode"
        },
        "MonitoredAccountIds": {
          "default": "Monitored Account IDs (Multi-Account)"
        },
        "CrossAccountExternalId": {
          "default": "Cross-Account External ID (Multi-Account)"
        },
        "MultiAccountMethod": {
          "default": "Multi-Account Method"
        },
        "OrganizationId": {
          "default": "AWS Organization ID (Org Mode)"
        },
        "OrgTrailBucket": {
          "default": "Organization Trail S3 Bucket (Org Mode)"
        },
        "LambdaCodeBucket": {
          "default": "Lambda Code S3 Bucket"
        },
        "LambdaCodeKey": {
          "default": "Lambda Code S3 Key"
        }
      }
    }
  },
  "Parameters": {
    "AthenaWorkgroups": {
      "Type": "String",
      "Description": "Comma-separated list of Athena workgroup names to monitor. Use '*' to monitor all workgroups. Example: primary,analytics,reporting",
      "Default": "*"
    },
    "S3BucketsToMonitor": {
      "Type": "String",
      "Description": "Comma-separated list of S3 bucket names related to Athena (data lakes, results). Use '*' to auto-detect Athena-related buckets. Example: my-datalake,athena-results",
      "Default": "*"
    },
    "CloudTrailBucket": {
      "Type": "String",
      "Description": "(Optional) S3 bucket containing CloudTrail logs for deeper analysis. Leave empty to use CloudTrail API only.",
      "Default": ""
    },
    "AnalysisIntervalMinutes": {
      "Type": "Number",
      "Description": "How often to run the analysis (in minutes). Default is 60 (1 hour).",
      "Default": 60,
      "MinValue": 5,
      "MaxValue": 1440
    },
    "RetentionDays": {
      "Type": "Number",
      "Description": "Number of days to retain analysis data in S3 and CloudWatch Logs",
      "Default": 90,
      "MinValue": 7,
      "MaxValue": 365
    },
    "KMSKeyArn": {
      "Type": "String",
      "Description": "(Optional) ARN of KMS key for encrypting S3 bucket and CloudWatch Logs. Leave empty to use AWS managed encryption (SSE-S3).",
      "Default": ""
    },
    "AnalysisMode": {
      "Type": "String",
      "Description": "Single account (analyse this account only) or multi-account (analyse multiple AWS accounts via cross-account roles).",
      "Default": "single",
      "AllowedValues": [
        "single",
        "multi"
      ]
    },
    "MonitoredAccountIds": {
      "Type": "String",
      "Description": "(Multi-account only) Comma-separated list of AWS account IDs to analyse. Leave empty for single-account mode.",
      "Default": ""
    },
    "CrossAccountExternalId": {
      "Type": "String",
      "Description": "(Multi-account only) Shared secret for cross-account AssumeRole. Must match the ExternalId in cross-account role templates.",
      "Default": ""
    },
    "MultiAccountMethod": {
      "Type": "String",
      "Description": "(Multi-account only) How accounts are discovered. 'manual' = explicit account IDs, 'org' = auto-discover via AWS Organizations.",
      "Default": "manual",
      "AllowedValues": [
        "manual",
        "org"
      ]
    },
    "OrganizationId": {
      "Type": "String",
      "Description": "(Org mode only) AWS Organization ID (starts with o-). Used for org trail S3 path construction.",
      "Default": ""
    },
    "OrgTrailBucket": {
      "Type": "String",
      "Description": "(Org mode only) S3 bucket containing the Organization CloudTrail trail logs.",
      "Default": ""
    },
    "LambdaCodeBucket": {
      "Type": "String",
      "Description": "S3 bucket containing the Lambda deployment package. Automatically set by deploy.py."
    },
    "LambdaCodeKey": {
      "Type": "String",
      "Description": "S3 key of the Lambda deployment package zip. Automatically set by deploy.py."
    }
  },
  "Conditions": {
    "UseKMSEncryption": {
      "Fn::Not": [
        {
          "Fn::Equals": [
            {
              "Ref": "KMSKeyArn"
            },
            ""
          ]
        }
      ]
    },
    "HasCloudTrailBucket": {
      "Fn::Not": [
        {
          "Fn::Equals": [
            {
              "Ref": "CloudTrailBucket"
            },
            ""
          ]
        }
      ]
    },
    "IsMultiAccountMode": {
      "Fn::Equals": [
        {
          "Ref": "AnalysisMode"
        },
        "multi"
      ]
    },
    "IsOrgMode": {
      "Fn::And": [
        {
          "Condition": "IsMultiAccountMode"
        },
        {
          "Fn::Equals": [
            {
              "Ref": "MultiAccountMethod"
            },
            "org"
          ]
        }
      ]
    },
    "HasOrgTrailBucket": {
      "Fn::Not": [
        {
          "Fn::Equals": [
            {
              "Ref": "OrgTrailBucket"
            },
            ""
          ]
        }
      ]
    },
    "IsOrgModeWithTrailBucket": {
      "Fn::And": [
        {
          "Condition": "IsOrgMode"
        },
        {
          "Condition": "HasOrgTrailBucket"
        }
      ]
    }
  },
  "Resources": {
    "AnalysisBucket": {
      "Type": "AWS::S3::Bucket",
      "DeletionPolicy": "Retain",
      "UpdateReplacePolicy": "Retain",
      "Properties": {
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": {
                  "Fn::If": [
                    "UseKMSEncryption",
                    "aws:kms",
                    "AES256"
                  ]
                },
                "KMSMasterKeyID": {
                  "Fn::If": [
                    "UseKMSEncryption",
                    {
                      "Ref": "KMSKeyArn"
                    },
                    {
                      "Ref": "AWS::NoValue"
                    }
                  ]
                }
              },
              "BucketKeyEnabled": {
                "Fn::If": [
                  "UseKMSEncryption",
                  true,
                  {
                    "Ref": "AWS::NoValue"
                  }
                ]
              }
            }
          ]
        },
        "OwnershipControls": {
          "Rules": [
            {
              "ObjectOwnership": "BucketOwnerEnforced"
            }
          ]
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true
        },
        "VersioningConfiguration": {
          "Status": "Enabled"
        },
        "LifecycleConfiguration": {
          "Rules": [
            {
              "Id": "ExpireOldAnalysis",
              "Status": "Enabled",
              "ExpirationInDays": {
                "Ref": "RetentionDays"
              }
            },
            {
              "Id": "CleanupIncompleteUploads",
              "Status": "Enabled",
              "AbortIncompleteMultipartUpload": {
                "DaysAfterInitiation": 1
              }
            },
            {
              "Id": "TransitionToIA",
              "Status": "Enabled",
              "Transitions": [
                {
                  "StorageClass": "STANDARD_IA",
                  "TransitionInDays": 30
                }
              ]
            },
            {
              "Id": "CleanupOldVersions",
              "Status": "Enabled",
              "NoncurrentVersionExpiration": {
                "NoncurrentDays": 30
              }
            }
          ]
        },
        "Tags": [
          {
            "Key": "Purpose",
            "Value": "AthenaUsageAnalysis"
          },
          {
            "Key": "ManagedBy",
            "Value": "CloudFormation"
          }
        ]
      }
    },
    "AnalysisBucketPolicy": {
      "Type": "AWS::S3::BucketPolicy",
      "Properties": {
        "Bucket": {
          "Ref": "AnalysisBucket"
        },
        "PolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Sid": "EnforceSSLOnly",
              "Effect": "Deny",
              "Principal": "*",
              "Action": "s3:*",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "AnalysisBucket",
                    "Arn"
                  ]
                },
                {
                  "Fn::Sub": "${AnalysisBucket.Arn}/*"
                }
              ],
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false"
                }
              }
            },
            {
              "Sid": "EnforceTLS12",
              "Effect": "Deny",
              "Principal": "*",
              "Action": "s3:*",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "AnalysisBucket",
                    "Arn"
                  ]
                },
                {
                  "Fn::Sub": "${AnalysisBucket.Arn}/*"
                }
              ],
              "Condition": {
                "NumericLessThan": {
                  "s3:TlsVersion": 1.2
                }
              }
            }
          ]
        }
      }
    },
    "AnalysisLogGroup": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": {
          "Fn::Sub": "/athena-usage-analyser/${AWS::StackName}"
        },
        "RetentionInDays": {
          "Ref": "RetentionDays"
        },
        "KmsKeyId": {
          "Fn::If": [
            "UseKMSEncryption",
            {
              "Ref": "KMSKeyArn"
            },
            {
              "Ref": "AWS::NoValue"
            }
          ]
        },
        "Tags": [
          {
            "Key": "Purpose",
            "Value": "AthenaUsageAnalysis"
          }
        ]
      }
    },
    "LambdaLogGroup": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": {
          "Fn::Sub": "/aws/lambda/${AWS::StackName}-analyser"
        },
        "RetentionInDays": {
          "Ref": "RetentionDays"
        },
        "KmsKeyId": {
          "Fn::If": [
            "UseKMSEncryption",
            {
              "Ref": "KMSKeyArn"
            },
            {
              "Ref": "AWS::NoValue"
            }
          ]
        },
        "Tags": [
          {
            "Key": "Purpose",
            "Value": "AthenaUsageAnalysis"
          }
        ]
      }
    },
    "LambdaExecutionRole": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "RoleName": {
          "Fn::Sub": "${AWS::StackName}-lambda-role"
        },
        "AssumeRolePolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              },
              "Action": "sts:AssumeRole"
            }
          ]
        },
        "Tags": [
          {
            "Key": "Purpose",
            "Value": "AthenaUsageAnalysis"
          }
        ]
      }
    },
    "LambdaLogsPolicy": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyName": "CloudWatchLogsAccess",
        "Roles": [
          {
            "Ref": "LambdaExecutionRole"
          }
        ],
        "PolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Sid": "WriteLambdaLogs",
              "Effect": "Allow",
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents"
              ],
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "LambdaLogGroup",
                    "Arn"
                  ]
                },
                {
                  "Fn::Sub": "${LambdaLogGroup.Arn}:*"
                }
              ]
            },
            {
              "Sid": "WriteAnalysisLogs",
              "Effect": "Allow",
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents"
              ],
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "AnalysisLogGroup",
                    "Arn"
                  ]
                },
                {
                  "Fn::Sub": "${AnalysisLogGroup.Arn}:*"
                }
              ]
            }
          ]
        }
      }
    },
    "CloudTrailPolicy": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyName": "CloudTrailReadAccess",
        "Roles": [
          {
            "Ref": "LambdaExecutionRole"
          }
        ],
        "PolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Sid": "LookupCloudTrailEvents",
              "Effect": "Allow",
              "Action": [
                "cloudtrail:LookupEvents"
              ],
              "Resource": "*"
            }
          ]
        }
      }
    },
    "CloudTrailBucketPolicy": {
      "Type": "AWS::IAM::Policy",
      "Condition": "HasCloudTrailBucket",
      "Properties": {
        "PolicyName": "CloudTrailBucketAccess",
        "Roles": [
          {
            "Ref": "LambdaExecutionRole"
          }
        ],
        "PolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Sid": "ReadCloudTrailLogs",
              "Effect": "Allow",
              "Action": [
                "s3:GetObject",
                "s3:ListBucket"
              ],
              "Resource": [
                {
                  "Fn::Sub": "arn:aws:s3:::${CloudTrailBucket}"
                },
                {
                  "Fn::Sub": "arn:aws:s3:::${CloudTrailBucket}/AWSLogs/*"
                }
              ]
            }
          ]
        }
      }
    },
    "OutputBucketPolicy": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyName": "OutputBucketAccess",
        "Roles": [
          {
            "Ref": "LambdaExecutionRole"
          }
        ],
        "PolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Sid": "WriteAnalysisOutput",
              "Effect": "Allow",
              "Action": [
                "s3:PutObject"
              ],
              "Resource": [
                {
                  "Fn::Sub": "${AnalysisBucket.Arn}/*"
                }
              ]
            }
          ]
        }
      }
    },
    "AthenaQueryPolicy": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyName": "AthenaQueryAccess",
        "Roles": [
          {
            "Ref": "LambdaExecutionRole"
          }
        ],
        "PolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Sid": "GetQueryDetails",
              "Effect": "Allow",
              "Action": [
                "athena:GetQueryExecution",
                "athena:BatchGetQueryExecution"
              ],
              "Resource": "*"
            }
          ]
        }
      }
    },
    "KMSPolicy": {
      "Type": "AWS::IAM::Policy",
      "Condition": "UseKMSEncryption",
      "Properties": {
        "PolicyName": "KMSAccess",
        "Roles": [
          {
            "Ref": "LambdaExecutionRole"
          }
        ],
        "PolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Sid": "UseKMSKey",
              "Effect": "Allow",
              "Action": [
                "kms:Encrypt",
                "kms:Decrypt",
                "kms:GenerateDataKey"
              ],
              "Resource": {
                "Ref": "KMSKeyArn"
              }
            }
          ]
        }
      }
    },
    "AnalyserFunction": {
      "Type": "AWS::Lambda::Function",
      "DependsOn": [
        "LambdaLogGroup",
        "LambdaLogsPolicy"
      ],
      "Properties": {
        "FunctionName": {
          "Fn::Sub": "${AWS::StackName}-analyser"
        },
        "Description": "Analyzes Athena usage patterns from CloudTrail events",
        "Runtime": "python3.14",
        "Handler": "index.lambda_handler",
        "Role": {
          "Fn::GetAtt": [
            "LambdaExecutionRole",
            "Arn"
          ]
        },
        "Timeout": 900,
        "MemorySize": 1024,
        "ReservedConcurrentExecutions": 1,
        "Environment": {
          "Variables": {
            "OUTPUT_BUCKET": {
              "Ref": "AnalysisBucket"
            },
            "CLOUDTRAIL_BUCKET": {
              "Ref": "CloudTrailBucket"
            },
            "LOOKBACK_MINUTES": {
              "Ref": "AnalysisIntervalMinutes"
            },
            "LOG_GROUP_NAME": {
              "Ref": "AnalysisLogGroup"
            },
            "ATHENA_WORKGROUPS": {
              "Ref": "AthenaWorkgroups"
            },
            "S3_BUCKETS_TO_MONITOR": {
              "Ref": "S3BucketsToMonitor"
            },
            "STACK_NAME": {
              "Ref": "AWS::StackName"
            },
            "MODE": "LOOKBACK",
            "ANALYSIS_MODE": {
              "Ref": "AnalysisMode"
            },
            "MONITORED_ACCOUNT_IDS": {
              "Ref": "MonitoredAccountIds"
            },
            "CROSS_ACCOUNT_EXTERNAL_ID": {
              "Ref": "CrossAccountExternalId"
            },
            "MULTI_ACCOUNT_METHOD": {
              "Ref": "MultiAccountMethod"
            },
            "ORGANIZATION_ID": {
              "Ref": "OrganizationId"
            },
            "ORG_TRAIL_BUCKET": {
              "Ref": "OrgTrailBucket"
            }
          }
        },
        "KmsKeyArn": {
          "Fn::If": [
            "UseKMSEncryption",
            {
              "Ref": "KMSKeyArn"
            },
            {
              "Ref": "AWS::NoValue"
            }
          ]
        },
        "Code": {
          "S3Bucket": {
            "Ref": "LambdaCodeBucket"
          },
          "S3Key": {
            "Ref": "LambdaCodeKey"
          }
        },
        "Tags": [
          {
            "Key": "Purpose",
            "Value": "AthenaUsageAnalysis"
          }
        ]
      }
    },
    "ScheduleRule": {
      "Type": "AWS::Events::Rule",
      "Properties": {
        "Name": {
          "Fn::Sub": "${AWS::StackName}-schedule"
        },
        "Description": "Triggers Athena usage analysis at regular intervals",
        "ScheduleExpression": {
          "Fn::Sub": "rate(${AnalysisIntervalMinutes} minutes)"
        },
        "State": "DISABLED",
        "Targets": [
          {
            "Id": "AnalyserTarget",
            "Arn": {
              "Fn::GetAtt": [
                "AnalyserFunction",
                "Arn"
              ]
            }
          }
        ]
      }
    },
    "SchedulePermission": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "FunctionName": {
          "Ref": "AnalyserFunction"
        },
        "Action": "lambda:InvokeFunction",
        "Principal": "events.amazonaws.com",
        "SourceArn": {
          "Fn::GetAtt": [
            "ScheduleRule",
            "Arn"
          ]
        }
      }
    },
    "CrossAccountAssumeRolePolicy": {
      "Type": "AWS::IAM::Policy",
      "Condition": "IsMultiAccountMode",
      "Properties": {
        "PolicyName": "CrossAccountAssumeRole",
        "Roles": [
          {
            "Ref": "LambdaExecutionRole"
          }
        ],
        "PolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Sid": "AssumeMonitoredAccountRoles",
              "Effect": "Allow",
              "Action": [
                "sts:AssumeRole"
              ],
              "Resource": "arn:aws:iam::*:role/AthenaUsageAnalyserReadRole"
            }
          ]
        }
      }
    },
    "OrganizationsDiscoveryPolicy": {
      "Type": "AWS::IAM::Policy",
      "Condition": "IsOrgMode",
      "Properties": {
        "PolicyName": "OrganizationsDiscovery",
        "Roles": [
          {
            "Ref": "LambdaExecutionRole"
          }
        ],
        "PolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Sid": "ListOrgAccounts",
              "Effect": "Allow",
              "Action": [
                "organizations:ListAccounts",
                "organizations:DescribeOrganization"
              ],
              "Resource": "*"
            }
          ]
        }
      }
    },
    "OrgTrailBucketPolicy": {
      "Type": "AWS::IAM::Policy",
      "Condition": "IsOrgModeWithTrailBucket",
      "Properties": {
        "PolicyName": "OrgTrailBucketAccess",
        "Roles": [
          {
            "Ref": "LambdaExecutionRole"
          }
        ],
        "PolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Sid": "ReadOrgTrailLogs",
              "Effect": "Allow",
              "Action": [
                "s3:GetObject",
                "s3:ListBucket"
              ],
              "Resource": [
                {
                  "Fn::Sub": "arn:aws:s3:::${OrgTrailBucket}"
                },
                {
                  "Fn::Sub": "arn:aws:s3:::${OrgTrailBucket}/AWSLogs/*"
                }
              ]
            }
          ]
        }
      }
    },
    "StsCallerIdentityPolicy": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyName": "StsCallerIdentity",
        "Roles": [
          {
            "Ref": "LambdaExecutionRole"
          }
        ],
        "PolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Sid": "GetCallerIdentity",
              "Effect": "Allow",
              "Action": [
                "sts:GetCallerIdentity"
              ],
              "Resource": "*"
            }
          ]
        }
      }
    }
  },
  "Outputs": {
    "AnalysisBucketName": {
      "Description": "S3 bucket containing analysis results",
      "Value": {
        "Ref": "AnalysisBucket"
      },
      "Export": {
        "Name": {
          "Fn::Sub": "${AWS::StackName}-AnalysisBucket"
        }
      }
    },
    "AnalysisBucketArn": {
      "Description": "ARN of the analysis S3 bucket",
      "Value": {
        "Fn::GetAtt": [
          "AnalysisBucket",
          "Arn"
        ]
      }
    },
    "LambdaFunctionArn": {
      "Description": "ARN of the analyser Lambda function",
      "Value": {
        "Fn::GetAtt": [
          "AnalyserFunction",
          "Arn"
        ]
      }
    },
    "LambdaFunctionName": {
      "Description": "Name of the analyser Lambda function",
      "Value": {
        "Ref": "AnalyserFunction"
      }
    },
    "LogGroupName": {
      "Description": "CloudWatch Log Group for analysis events",
      "Value": {
        "Ref": "AnalysisLogGroup"
      }
    },
    "ExportsLocation": {
      "Description": "S3 path where zip exports are stored",
      "Value": {
        "Fn::Sub": "s3://${AnalysisBucket}/exports/"
      }
    },
    "InstructionsForCustomer": {
      "Description": "Instructions for retrieving analysis data",
      "Value": {
        "Fn::Sub": "To retrieve Athena usage analysis:\n1. Analysis runs every ${AnalysisIntervalMinutes} minutes automatically\n2. Download exports from: s3://${AnalysisBucket}/exports/\n3. View logs in CloudWatch Log Group: /athena-usage-analyser/${AWS::StackName}"
      }
    },
    "AnalysisMode": {
      "Description": "Whether the stack is running in single or multi-account mode",
      "Value": {
        "Ref": "AnalysisMode"
      }
    },
    "MonitoredAccountIds": {
      "Description": "Comma-separated list of monitored account IDs (multi-account mode only)",
      "Value": {
        "Ref": "MonitoredAccountIds"
      }
    },
    "MultiAccountMethod": {
      "Description": "How accounts are discovered (manual or org)",
      "Value": {
        "Ref": "MultiAccountMethod"
      }
    },
    "OrganizationId": {
      "Description": "AWS Organization ID (org mode only)",
      "Value": {
        "Ref": "OrganizationId"
      }
    }
  }
}